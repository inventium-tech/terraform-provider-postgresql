name: auto-pr
run-name: 'ðŸ¤– Auto PR - ${{ github.ref_name }}'

on:
  push:
    branches:
      - feat/**
      - fix/**
      - hotfix/**
      - release/**
      - refactor/**
      - chore/**
      - docs/**
      - style/**
      - test/**
      - ci/**
      - perf/**

permissions:
  contents: read

jobs:
  auto-pr:
    name: Auto PR
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ðŸ’»
        uses: actions/checkout@v4.1.7

      - name: Create PR ðŸš€
        uses: actions/github-script@v7.0.1
        with:
          script: |
            
            console.log("USE CONTEXT:", ${{ github.ref_name}})
            console.log(context.payload)
            
            const msg = context.payload.head_commit.message;            // get latest commit on the branch
            let [title, body] = msg.split('\n').filter((x) => !!x);     // split the commit message into title and body
            let [owner, repo] = '${{ github.repository }}'.split('/');  // get the owner and repo name
            
            console.log("PAYLOAD:", {
              owner: owner                  // The account owner of the repository
              repo: repo                    // The name of the repository without the .git extension
              head: '${{ github.ref_name}}' // The name of the branch where your changes are implemented
              base: 'dev'                   // The name of the branch you want the changes pulled into
              title: title                  // The title of the pull request
              body: body.join('\n')         // The body of the pull request
              maintainer_can_modify: true   // Allow maintainers to modify the PR
            });
            
